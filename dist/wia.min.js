function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){e.Wia=e.Wia||{},e.Wia.VERSION="1.0.0"}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;"undefined"!=typeof e.$&&(n.$=e.$),n.restApiEndpoint="https://api.wia.io/v1/",n.streamApi={protocol:"wss",host:"websockets.wia.io",port:3001,useSecure:!0,connectTimeout:1500,streamTimeout:15},n.clientInfo=null,n.initialize=function(e){n._initialize(e)},n._initialize=function(e){n.appKey=e.appKey||null,n.secretKey=e.secretKey||null,n.accessToken=e.accessToken||null,n.restApiEndpoint=e.restApiEndpoint||n.restApiEndpoint;for(var t in e.streamApi)e.streamApi.hasOwnProperty(t)&&(n.streamApi[t]=e.streamApi[t]);if(n.secretKey||n.accessToken)var i=setInterval(function(){n._restClient._get("whoami",{},function(e){n.clientInfo=e,clearInterval(i)},function(e){console.log(e)})},1250)}}(this),function(e){function n(e){return i.secretKey&&e.setRequestHeader("Authorization","Bearer "+i.secretKey),i.accessToken&&e.setRequestHeader("Authorization","Bearer "+i.accessToken),i.appKey&&e.setRequestHeader("x-app-key",i.appKey),e}function t(e){var n=[];for(var t in e)e.hasOwnProperty(t)&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")}e.Wia=e.Wia||{};var i=e.Wia;i._restClient=i._restClient||{},i._restClient._get=function(e,o,s,c){var r=new XMLHttpRequest,u=i.restApiEndpoint+e;o&&(u+="?"+t(o)),r.open("get",u,!0),r=n(r),r.responseType="json",r.onload=function(){var e=r.status;200===e?s(r.response):c({status:r.status,response:r.response})},r.send()},i._restClient._post=function(e,t,o,s){var c=new XMLHttpRequest;c.open("post",i.restApiEndpoint+e,!0),c=n(c),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.responseType="json",c.onload=function(){var e=c.status;200===e||201===e?o(c.response):s({status:c.status,response:c.response})},c.send(JSON.stringify(t||{}))},i._restClient._put=function(e,t,o,s){var c=new XMLHttpRequest;c.open("put",i.restApiEndpoint+e,!0),c=n(c),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.responseType="json",c.onload=function(){var e=c.status;200===e||201===e?o(c.response):s({status:c.status,response:c.response})},c.send(JSON.stringify(t||{}))},i._restClient._delete=function(e,t,o){var s=new XMLHttpRequest;s.open("delete",i.restApiEndpoint+e,!0),s=n(s),s.responseType="json",s.onload=function(){var e=s.status;200===e?t(s.response):o({status:s.status,response:s.response})},s.send()}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.stream=n.stream||{},n.stream.connected=!1;var t={},i={};n.stream.subscribe=function(e,o){t[e]=new WebSocket("".concat(n.streamApi.protocol,"://").concat(n.streamApi.host,"/").concat(e)),o&&"function"==typeof o&&(i[e]=o),t[e].onopen=function(){n.stream.connected=!0,console.log("Connected to stream!")},t[e].onclose=function(){n.stream.connected=!1,console.log("Not connected to stream.")},t[e].onerror=function(e){n.stream.connected=!1,console.log("WebSocket Error "+e),console.log("Not connected to stream.")},t[e].onmessage=function(t){n.stream.connected=!0;try{var o=JSON.parse(t.data),s=function(){i[e]&&"function"==typeof i[e]&&(console.log("Server: "+t.data),i[e](o))},c=e;if(0===c.indexOf("devices")){var r=c.match("devices/(.*?)/(.*)");if(r){var u=r[2];if(0===u.indexOf("locations")&&"location"===o.type)s();else if(0===u.indexOf("events")&&"event"===o.type)if(0===u.indexOf("events/+"))s();else{var a=u.split("events/")[1];o.name===a&&s()}else if(0===u.indexOf("logs")&&"log"===o.type)if(0===u.indexOf("logs/+"))s();else{var f=u.split("logs/")[1];o.id===f&&s()}}else s()}}catch(p){console.log(p)}}},n.stream.unsubscribe=function(e){t[e].close(),n.stream.connected=!1},n.stream.unsubscribeAll=function(){for(var e in t)t.hasOwnProperty(e)&&(n.stream.connected&&n.stream.unsubscribe(e),delete t[e])}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.commands=n.commands||{},n.commands.subscribe=function(e,t){if(!e)throw new Error("Options cannot be null");"undefined"!=typeof n.clientInfo&&"undefined"!=typeof n.clientInfo.id?n.stream.subscribe("devices/"+n.clientInfo.id+"/commands/"+e.slug+"/run",t):setTimeout(function(){"undefined"!=typeof n.clientInfo&&"undefined"!=typeof n.clientInfo.id&&n.stream.subscribe("devices/"+n.clientInfo.id+"/commands/"+e.slug+"/run",t)},5e3)},n.commands.run=function(e,t,i){if(!e)throw new Error("Options cannot be null");n._restClient._post("commands/run",e,function(e){t&&"function"==typeof t&&t(e)},function(e){i&&"function"==typeof i&&i(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.devices=n.devices||{},n.devices.create=function(e,t,i){if(!e)throw new Error("Options cannot be null");if(!e.name)throw new Error("You must provide a Device name");if(!e.spaceId&&!e.space&&!e["space.id"])throw new Error("You must provide a spaceId property");n._restClient._post("devices",e,function(e){t&&"function"==typeof t&&t(e)},function(e){i&&"function"==typeof i&&i(e)})},n.devices.retrieve=function(e,t,i){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Device ID");n._restClient._get("devices/"+e,{},function(e){t&&"function"==typeof t&&t(e)},function(e){i&&"function"==typeof i&&i(e)})},n.devices.update=function(e,t,i,o){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Device ID");n._restClient._put("devices/"+e,t,function(e){i&&"function"==typeof i&&i(e)},function(e){o&&"function"==typeof o&&o(e)})},n.devices["delete"]=function(e,t,i){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Device ID");n._restClient._delete("devices/"+e,function(e){t&&"function"==typeof t&&t(e)},function(e){i&&"function"==typeof i&&i(e)})},n.devices.list=function(e,t,i){if(!e["space.id"])throw new Error("You must provide a space.id property");n._restClient._get("devices",e,function(e){t&&"function"==typeof t&&t(e.devices,e.count)},function(e){i&&"function"==typeof i&&i(e)})},n.devices.subscribe=function(e,t){"object"===_typeof(e)?e.id&&n.stream.subscribe("devices/"+e.id,t):n.stream.subscribe("devices/"+e,t)},n.devices.unsubscribe=function(e){"object"===_typeof(e)?e.id&&n.stream.unsubscribe("devices/"+e.id):n.stream.unsubscribe("devices/"+e)}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.events=n.events||{},n.events.publish=function(e,t){n._restClient._post("events",e,function(e){t(e)},function(e){t(e)})},n.events.list=function(e,t,i){if(!e["device.id"])throw new Error("You must provide a device.id property");n._restClient._get("events",e,function(e){t(e.events,e.count)},function(e){i(e)})},n.events.subscribe=function(e,t){e.name?n.stream.subscribe("devices/"+e.device+"/events/"+e.name,t):n.stream.subscribe("devices/"+e.device+"/events/+",t)},n.events.unsubscribe=function(e,t){e.name?n.stream.unsubscribe("devices/"+e.device+"/events/"+e.name,t):n.stream.unsubscribe("devices/"+e.device+"/events/+",t)}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.functions=n.functions||{},n.functions.list=function(e,t,i){n._restClient._get("functions",e,function(e){t(e.functions,e.count)},function(e){i(e)})},n.functions.call=function(e,t,i){if(!e)return i({message:"No options specified."});var o=null;o="object"===_typeof(e)?e.id:e,n._restClient._post("functions/"+o+"/call",e,function(e){t(e)},function(e){i(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.locations=n.locations||{},n.locations.publish=function(e,t){n._restClient._post("events",e,function(e){t(e)},function(e){t(e)})},n.locations.list=function(e,t,i){n._restClient._get("locations",e,function(e){t(e.locations,e.count)},function(e){i(e)})},n.locations.subscribe=function(e,t){n.stream.subscribe("devices/"+e.device+"/locations",t)},n.locations.unsubscribe=function(e,t){n.stream.unsubscribe("devices/"+e.device+"/locations",t)}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.logs=n.logs||{},n.logs.publish=function(e,t){n._restClient._post("events",e,function(e){t(e)},function(e){t(e)})},n.logs.list=function(e,t,i){n._restClient._get("logs",e,function(e){t(e.logs,e.count)},function(e){i(e)})},n.logs.subscribe=function(e,t){e.name?n.stream.subscribe("devices/"+e.device+"/logs/"+e.level,t):n.stream.subscribe("devices/"+e.device+"/logs/+",t)},n.logs.unsubscribe=function(e,t){e.name?n.stream.unsubscribe("devices/"+e.device+"/logs/"+e.level,t):n.stream.unsubscribe("devices/"+e.device+"/logs/+",t)}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.spaces=n.spaces||{},n.spaces.create=function(e,t,i){if(!e)throw new Error("Options cannot be null");n._restClient._post("spaces",e,function(e){t&&"function"==typeof t&&t(e)},function(e){i&&"function"==typeof i&&i(e)})},n.spaces.retrieve=function(e,t,i){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Space ID");n._restClient._get("spaces/"+e,{},function(e){t&&"function"==typeof t&&t(e)},function(e){i&&"function"==typeof i&&i(e)})},n.spaces.update=function(e,t,i,o){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Space ID");n._restClient._put("spaces/"+e,t,function(e){i&&"function"==typeof i&&i(e)},function(e){o&&"function"==typeof o&&o(e)})},n.spaces.list=function(e,t,i){n._restClient._get("spaces",e,function(e){t&&"function"==typeof t&&t(e.spaces,e.count)},function(e){i&&"function"==typeof i&&i(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.users=n.users||{},n.users.retrieve=function(e,t,i){n._restClient._get("users/"+e,{},function(e){t(e)},function(e){i(e)})}}(this);