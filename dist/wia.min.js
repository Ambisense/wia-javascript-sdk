function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e){e.Wia=e.Wia||{},e.Wia.VERSION="1.0.0"}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;"undefined"!=typeof e.$&&(n.$=e.$),n.restApiEndpoint="http://local.wia.io:8081/v1/",n.streamApi={protocol:"wss",host:"api.wia.io",port:3001,useSecure:!0,connectTimeout:1500,streamTimeout:15},n.clientInfo=null,n.initialize=function(e){n._initialize(e)},n._initialize=function(e){n.appKey=e.appKey||null,n.secretKey=e.secretKey||null,n.accessToken=e.accessToken||null,n.restApiEndpoint=e.restApiEndpoint||n.restApiEndpoint;for(var t in e.streamApi)e.streamApi.hasOwnProperty(t)&&(n.streamApi[t]=e.streamApi[t]);if(n.secretKey||n.accessToken)var o=setInterval(function(){n._restClient._get("whoami",{},function(e){n.clientInfo=e,clearInterval(o)},function(e){console.log(e)})},1250)}}(this),function(e){function n(e){return o.secretKey&&e.setRequestHeader("Authorization","Bearer "+o.secretKey),o.accessToken&&e.setRequestHeader("Authorization","Bearer "+o.accessToken),o.appKey&&e.setRequestHeader("x-app-key",o.appKey),e}function t(e){var n=[];for(var t in e)e.hasOwnProperty(t)&&n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t]));return n.join("&")}e.Wia=e.Wia||{};var o=e.Wia;o._restClient=o._restClient||{},o._restClient._get=function(e,i,s,c){var r=new XMLHttpRequest,u=o.restApiEndpoint+e;i&&(u+="?"+t(i)),r.open("get",u,!0),r=n(r),r.responseType="json",r.onload=function(){var e=r.status;200===e?s(r.response):c({status:r.status,response:r.response})},r.send()},o._restClient._post=function(e,t,i,s){var c=new XMLHttpRequest;c.open("post",o.restApiEndpoint+e,!0),c=n(c),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.responseType="json",c.onload=function(){var e=c.status;200===e||201===e?i(c.response):s({status:c.status,response:c.response})},c.send(JSON.stringify(t||{}))},o._restClient._put=function(e,t,i,s){var c=new XMLHttpRequest;c.open("put",o.restApiEndpoint+e,!0),c=n(c),c.setRequestHeader("Content-Type","application/json;charset=UTF-8"),c.responseType="json",c.onload=function(){var e=c.status;200===e||201===e?i(c.response):s({status:c.status,response:c.response})},c.send(JSON.stringify(t||{}))},o._restClient._delete=function(e,t,i){var s=new XMLHttpRequest;s.open("delete",o.restApiEndpoint+e,!0),s=n(s),s.responseType="json",s.onload=function(){var e=s.status;200===e?t(s.response):i({status:s.status,response:s.response})},s.send()}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.stream=n.stream||{},n.stream.connected=!1;var t={},o=null;n.stream.initialize=function(){console.log(n.streamApi),o=new Paho.MQTT.Client(n.streamApi.host,parseInt(n.streamApi.port),"/",""),o.onConnectionLost=function(e){n.stream.connected=!1,n.stream.onConnectionLost&&n.stream.onConnectionLost(e),setTimeout(function(){console.log("Attempting reconnect..."),o.connect({onSuccess:function(){console.log("Reconnected.");for(var e in t)t.hasOwnProperty(e)&&o.subscribe(e)},onFailure:function(){console.log("Could not reconnect.")}},n.streamApi.connectTimeout)})},o.onMessageArrived=function(e){var n=e.destinationName;try{if(0===n.indexOf("devices")){var o=n.match("devices/(.*?)/(.*)");if(o){var i=o[1],s=o[2],c=e.payloadString,r=null;if(r=c&&c.length>0?JSON.parse(c):{},s.indexOf("/")>=0){var u=s.match("(.*?)/(.*)");r.type=u[1]}else r.type=s;t["devices/"+i+"/#"]&&"function"==typeof t["devices/"+i+"/#"]&&t["devices/"+i+"/#"](r),t[n]&&"function"==typeof t[n]&&t[n](r),0===s.indexOf("events")&&"function"==typeof t["devices/"+i+"/events/+"]?t["devices/"+i+"/events/+"](r):0===s.indexOf("logs")&&"function"==typeof t["devices/"+i+"/logs/+"]?t["devices/"+i+"/logs/+"](r):0===s.indexOf("locations")&&"function"==typeof t["devices/"+i+"/locations/+"]?t["devices/"+i+"/locations/+"](r):0===s.indexOf("sensors")&&"function"==typeof t["devices/"+i+"/sensors/+"]?t["devices/"+i+"/sensors/+"](r):0===s.indexOf("commands")&&exec(r.command,function(e,n,t){e&&console.log(e),n&&console.log(n),t&&console.log(t)})}}}catch(a){console.log(a)}},o.onMessageDelivered=function(e){n.stream.onMessageDelivered&&n.stream.onMessageDelivered(e)}},n.stream.connect=function(e){e||(e={}),console.log(n.streamApi),n.secretKey||n.appKey?o.connect({timeout:n.streamApi.streamTimeout,userName:n.secretKey||n.appKey,password:" ",useSSL:n.streamApi.useSecure,onSuccess:function(){n.stream.connected=!0,e&&e.onSuccess&&e.onSuccess()},onFailure:function(t){n.stream.connected=!1,e&&e.onFailure&&e.onFailure(t)}}):n.stream.connected=!1},n.stream.disconnect=function(){n.stream.connected=!1,o.disconnect()},n.stream.subscribe=function(e,i){t[e]=i,n.stream.connected&&o.subscribe(e,{qos:0})},n.stream.unsubscribe=function(e){delete t[e],n.stream.connected&&o.unsubscribe(e)},n.stream.unsubscribeAll=function(){for(var e in t)t.hasOwnProperty(e)&&(n.stream.connected&&o.unsubscribe(e),delete t[e])},n.stream.publish=function(e,n){var t=new Paho.MQTT.Message(n);t.destinationName=e,o.send(t)}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.commands=n.commands||{},n.commands.run=function(e,t,o){if(!e)throw new Error("Options cannot be null");n._restClient._post("commands/run",e,function(e){t&&"function"==typeof t&&t(e)},function(e){o&&"function"==typeof o&&o(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.devices=n.devices||{},n.devices.create=function(e,t,o){if(!e)throw new Error("Options cannot be null");if(!e.name)throw new Error("You must provide a Device name");if(!e.spaceId&&!e.space&&!e["space.id"])throw new Error("You must provide a spaceId property");n._restClient._post("devices",e,function(e){t&&"function"==typeof t&&t(e)},function(e){o&&"function"==typeof o&&o(e)})},n.devices.retrieve=function(e,t,o){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Device ID");n._restClient._get("devices/"+e,{},function(e){t&&"function"==typeof t&&t(e)},function(e){o&&"function"==typeof o&&o(e)})},n.devices.update=function(e,t,o,i){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Device ID");n._restClient._put("devices/"+e,t,function(e){o&&"function"==typeof o&&o(e)},function(e){i&&"function"==typeof i&&i(e)})},n.devices["delete"]=function(e,t,o){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Device ID");n._restClient._delete("devices/"+e,function(e){t&&"function"==typeof t&&t(e)},function(e){o&&"function"==typeof o&&o(e)})},n.devices.list=function(e,t,o){if(!e["space.id"])throw new Error("You must provide a space.id property");n._restClient._get("devices",e,function(e){t&&"function"==typeof t&&t(e.devices,e.count)},function(e){o&&"function"==typeof o&&o(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.events=n.events||{},n.events.publish=function(e,t){n._restClient._post("events",e,function(e){t(e)},function(e){t(e)})},n.events.list=function(e,t,o){if(!e["device.id"])throw new Error("You must provide a device.id property");n._restClient._get("events",e,function(e){t(e.events,e.count)},function(e){o(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.functions=n.functions||{},n.functions.list=function(e,t,o){n._restClient._get("functions",e,function(e){t(e.functions,e.count)},function(e){o(e)})},n.functions.call=function(e,t,o){if(!e)return o({message:"No options specified."});var i=null,s=null;"object"===_typeof(e)?(i=e.id,s=e.device):i=e,n._restClient._post("functions/"+i+"/call",e,function(e){t(e)},function(e){o(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.locations=n.locations||{},n.locations.publish=function(e,t){n._restClient._post("events",e,function(e){t(e)},function(e){t(e)})},n.locations.list=function(e,t,o){n._restClient._get("locations",e,function(e){t(e.locations,e.count)},function(e){o(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.logs=n.logs||{},n.logs.publish=function(e,t){n._restClient._post("events",e,function(e){t(e)},function(e){t(e)})},n.logs.list=function(e,t,o){n._restClient._get("logs",e,function(e){t(e.logs,e.count)},function(e){o(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.spaces=n.spaces||{},n.spaces.create=function(e,t,o){if(!e)throw new Error("Options cannot be null");n._restClient._post("spaces",e,function(e){t&&"function"==typeof t&&t(e)},function(e){o&&"function"==typeof o&&o(e)})},n.spaces.retrieve=function(e,t,o){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Space ID");n._restClient._get("spaces/"+e,{},function(e){t&&"function"==typeof t&&t(e)},function(e){o&&"function"==typeof o&&o(e)})},n.spaces.update=function(e,t,o,i){if(!e||"string"!=typeof e)throw new Error("You must provide a valid Space ID");n._restClient._put("spaces/"+e,t,function(e){o&&"function"==typeof o&&o(e)},function(e){i&&"function"==typeof i&&i(e)})},n.spaces.list=function(e,t,o){n._restClient._get("spaces",e,function(e){t&&"function"==typeof t&&t(e.spaces,e.count)},function(e){o&&"function"==typeof o&&o(e)})}}(this),function(e){e.Wia=e.Wia||{};var n=e.Wia;n.users=n.users||{},n.users.retrieve=function(e,t,o){n._restClient._get("users/"+e,{},function(e){t(e)},function(e){o(e)})}}(this);